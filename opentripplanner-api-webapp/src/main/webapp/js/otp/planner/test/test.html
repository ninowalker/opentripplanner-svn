<html debug="true">
<head>
    <title>Trip Planner Demo</title>
    <link rel="stylesheet" type="text/css" href="/js/extjs/resources/css/ext-all-notheme.css" />
    <link rel="stylesheet" type="text/css" href="/js/extjs/resources/css/xtheme-gray-extend.css" />
    <link rel="stylesheet" type="text/css" href="/js/openlayers/theme/default/style.css" />
    <link rel="stylesheet" type="text/css" href="/js/eAPI/eAPI-all-min.css"/>
    <!-- yes debug --
        <script type='text/javascript' src='http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js'></script>
    <!-- end debug -->
    
    
    <!--  map stuff -->
    <script src="/js/openlayers/OpenLayers.js"></script>
    <script src="/js/extjs/adapter/ext/ext-base.js"></script>
    <script src="/js/extjs/ext-trimet-min.js"></script>
    <script src="/js/geoext/GeoExt.js"></script>
    
    <script type="text/javascript" src="/js/eAPI/eAPI-all.js"></script>
    
    
    <!-- included here to override eAPI for editing / development purposes under this folder -->
    <link rel="stylesheet" type="text/css" href="planner.css"/>
    <script type="text/javascript" src="/js/trimet/map/poi/Control.js"></script>
    <script type="text/javascript" src="Planner.js"></script>
    <script type="text/javascript" src="Forms.js"></script>
    <script type="text/javascript" src="Templates.js"></script>
    <script type="text/javascript" src="TripTab.js"></script>
    <style>
    </style>
</head>
<body>
<div class="logo" id="logo"> 
    <a href="http://trimet.org" title="Back to TriMet Home"><img src="/images/ui/buttons/logoSmall.gif" alt="Back to TriMet Home"/></a>
</div> 
<script type="text/javascript">
var page_start = Number(new Date());
Ext.onReady(function()
{
    OpenLayers.ImgPath = "/images/map/controls/ltgray/";

    var pro  = new trimet.locale.profile.Base();
    var map  = new trimet.map.SimpleMap({tileURLs:trimet.utils.Constants.tileTestServers, attribution:trimet.utils.ExtUtils.MAP_ATTRIBUTION});
    var ui   = new trimet.widget.ui.UI({map:map});
    var tbar = new trimet.widget.ui.Buttons({ui:ui,profile:pro});
    var poi  = new trimet.map.poi.Control({map:map.getMap()});

    // wfs, search & planner mock TEST data (set if to false to use
    var vurl, surl, gxconfig;
    if(true)
    {
        surl = '/js/trimet/widget/search/test.json';
        vurl = '/js/trimet/widget/vehicles/test/vehicles.json';
        trimet.utils.URL.plannerGEO = "/js/trimet/widget/planner/test/test.json";
        trimet.utils.URL.planner    = "/js/trimet/widget/planner/test/test.xml";
        //trimet.utils.URL.planner    = "/js/trimet/widget/planner/test/to.xml";
        trimet.utils.URL.planner    = "/js/trimet/widget/planner/test/from.xml";
        trimet.utils.URL.planner    = "/js/trimet/widget/planner/test/fromTo.xml";

        // overlay
        trimet.utils.URL.cachedWMS = trimet.utils.URL.wmsCacheTest;
        trimet.utils.URL.wfs = '/js/trimet/widget/overlay/test/wfs-portland.json';
        
        // wfs mock stop data
        trimet.map.wfs.MapDecorator.url = "/js/trimet/map/wfs/test/test.xml";
        gxconfig = {landmarkURL:"/js/trimet/map/wfs/test/testStop.json", mapPanel:ui.center}
    }

    ////////// trip planner ///////////
    var tp = new trimet.widget.planner.Planner({map:map, poi:poi});
    var cm = new trimet.widget.ui.ContextMenu({map:map, forms:tp.getForms()});
    ui.accordion.add(tp.getPanel());

    ////////// measure distance ///////////
    var measure = new trimet.widget.measure.Measure({map:map.getMap()});
    var mb  = tbar.getMeasure();
    mb.show();
    mb.on("toggle", measure.toggle, measure);

    ////////// search  ///////////
    var search  = new trimet.widget.search.Search({profile:pro, url:surl, poi:poi});
    var sp      = search.getPanel();
    ui.accordion.add(sp);

    ////////// mobility overlay ///////////
    var ob = tbar.getOverlay();
    var overlay = trimet.widget.overlay.Factory.create(ui, map, ob);
    ui.accordion.add(overlay.getPanel());

    // wfs decorator to add stops popups to the map -- note, this is done last, so the feature layer appears ontop
    if(Ext.isIE)  // on IE, don't show stops until 6th zoom level
        trimet.map.wfs.MapDecorator.stopZoomResolution = 4;
    trimet.map.wfs.MapDecorator.decorate(map, trimet.map.wfs.GxControl, gxconfig);
    map.getMap().setCenter(new OpenLayers.LonLat(7616862, 607850), 6);

    ////////// clear ///////////
    clear = function() 
    {
        tp.clear();
        overlay.clear();
        poi.clear();

        var fs = tbar.getFullScreen();
        fs.toggle(false);
        ui.fullScreen(false);

        mb.toggle(false);
    }
    var cb = tbar.getClear();
    cb.on("click", clear, this);

    ui.accordion.doLayout();

    // page load performance numbers
    var page_end = Number(new Date());
    var time_page = page_end - page_start;
    console.log("load time: " + time_page)
});
</script>
<script>var g_page_start = Number(new Date()); trimet.utils.AnalyticsUtils.importGoogleAnalytics();</script>
<script>
    Ext.onReady(function()
    {
        trimet.utils.AnalyticsUtils.initGoogleAnalytics();

        var g_page_end = Number(new Date());
        var g_time_page = g_page_end - g_page_start;
        var t_time_page = g_page_end - page_start;
        console.log("google load time: " + g_time_page + " (total page: " + t_time_page + " )")
    });
    </script>
    <!--
    doesn't work
    <script>setTimeout('trimet.utils.AnalyticsUtils.importGoogleAnalytics()', 2000);</script>
    <script>setTimeout('trimet.utils.AnalyticsUtils.initGoogleAnalytics()', 2200);</script>
    --> 
</body>
</html>